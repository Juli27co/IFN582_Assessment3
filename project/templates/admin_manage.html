{% extends 'base.html' %}
{% import 'bootstrap5/form.html' as wtf %}

{% block head %}

<!-- delete later -->
      <!-- {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ category }} alert-dismissible fade show mt-3" role="alert">
                <p>{{ message }}</p>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %} -->

        <h1 class="display-5 text-center mt-3 mb-3">Manage Service!</h1>
        <p class="lead text-center">
              Use these forms to add new Services, Types, and Add-Ons.
        </p>
{% endblock %}

{% block main %}
    <div class="container">
          <details class="mb-3">
              <summary class="bg-primary text-white p-2 rounded">
                  <span class="lead">Add Service</span>
              </summary>
              <div class="row justify-content-center p-3">
                  <div class="col-md-6">
                      <p>Adds a new service to database.</p>
                      {{ wtf.render_form(serviceForm, action=url_for('main.add_new_service'), method='post') }}
                  </div>
              </div>
          </details>
          <details class="mb-3">
              <summary class="bg-primary text-white p-2 rounded">
                  <span class="lead">Add Type</span>
              </summary>
              <div class="row justify-content-center p-3">
                  <div class="col-md-6">
                      <p>Adds a new type/package for a service.</p>
                      {{ wtf.render_form(typeForm, action=url_for('main.add_new_type'), method='post') }}
                  </div>
              </div>
          </details>

          <details class="mb-3">
              <summary class="bg-primary text-white p-2 rounded">
                  <span class="lead">Add Add-On</span>
              </summary>
              <div class="row justify-content-center p-3">
                  <div class="col-md-6">
                      <p>Adds optional extras customers can choose.</p>
                      {{ wtf.render_form(addonForm, action=url_for('main.add_new_addon'), method='post') }}
                  </div>
              </div>
          </details>
          
          <div class="text-end">
            <a class="btn btn-outline-secondary" href="{{ url_for('main.index') }}">Back</a></div>


<h3 class="mt-4">Services</h3>
<div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
    <thead class="table-secondary">
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Short Description</th>
        <th>Price</th>
        <th>Cover</th>
        <th class="text-end">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for service in services %}
      <tr>
        <td>{{ service.id }}</td>
        <td>{{ service.name }}</td>
        <td>{{ service.shortDescription }}</td>
        <td>{{ '%.2f'|format(service.price) }}</td>
        <td>
          {% if service.coverImage %}
            <img src="{{ url_for('static', filename='img/' ~ service.coverImage) }}" alt="" style="height:40px;object-fit:cover;">
          {% else %}â€”{% endif %}
        </td>
        <td class="text-end">
                <form method="post" action="{{ url_for('main.delete_service') }}">
                  {{ serviceForm.csrf_token }}
                  <input type="hidden" name="service_id" value="{{ service.id }}">
                  <button type="submit" class="btn btn-danger"
                          onclick="return confirm('Delete this service?');">
                    Delete
                  </button>
                </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<h3 class="mt-4">Sessions</h3>
<div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
    <thead class="table-secondary">
      <tr>
        <th>ID</th>
        <th>Service Type</th>
        <th>Short Description</th>
        <th>Price</th>
        <th class="text-end">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for t in types %}
      <tr>
        <td>{{ t.id }}</td>
        <td>{{ t.name}}</td>
        <td>{{ t.shortDescription }}</td>
        <td>{{ '%.2f'|format(t.price) }}</td>
        <td class="text-end">
                <form method="post" action="{{ url_for('main.delete_type') }}">
                  {{ typeForm.csrf_token }}
                  <input type="hidden" name="type_id" value="{{ t.id }}">
                  <button type="submit" class="btn btn-danger"
                          onclick="return confirm('Delete this session type?');">
                    Delete
                  </button>
                </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<h3 class="mt-4">Add-ons</h3>
<div class="table-responsive">
  <table class="table table-striped table-hover align-middle">
    <thead class="table-secondary">
      <tr>
        <th>ID</th>
        <th>Add-on</th>
        <th>Price</th>
        <th class="text-end">Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for addon in addons %}
      <tr>
        <td>{{ addon.id }}</td>
        <td>{{ addon.addOn }}</td>
        <td>{{ '%.2f'|format(addon.price) }}</td>
        <td class="text-end">
                <form method="post" action="{{ url_for('main.delete_addon') }}">
                  {{ addonForm.csrf_token }}
                  <input type="hidden" name="addon_id" value="{{ addon.id }}">
                  <button type="submit" class="btn btn-danger"
                          onclick="return confirm('Delete this add-on?');">
                    Delete
                  </button>
                </form>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>       
  </div>

{% endblock %}